<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebGL experimentation</title>

    <!-- JQUERY Libs //-->
    <script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
    <!-- MATH Libs //-->
    <script src="js/math/gl-matrix.js"></script>
    <!-- WEBGL Libs //-->
    <script src="https://rawgithub.com/mrdoob/three.js/master/build/three.js"></script>
    <script src="js/webgl/Utils.js"></script>

    <script id="shader-vs" type="x-shader/x-vertex">
        attribute vec4 a_Position;

        uniform mat4 u_MVMatrix;
        uniform mat4 u_PMatrix;

        void main() {
           gl_Position = u_PMatrix * u_MVMatrix * a_Position;
           gl_PointSize = 10.0;
        }
    </script>

    <script id="shader-fs" type="x-shader/x-fragment">
        precision mediump float;

        uniform vec4 u_FragColor;

        void main() {
           gl_FragColor = u_FragColor;
        }
    </script>

    <script id="code-js" type="text/javascript">

        function runThreeJsApp() {
            configure();
            load();
            render();
        }

        (function() {

            var canvas, c_width, c_height, halfWidth, halfHeight;

            var scene;
            var camera;

            var renderer;

            var head, body, leftLeg, rightLeg, leftArm, rightArm;

            var animationRate = 15; // 15ms
            var initialTime = (new Date).getTime();
            var elapsedTime;
            var sceneTime = 0.0;

            window.configure = function() {
                canvas = document.getElementById("canvas-id");
                c_width = canvas.width;
                c_height = canvas.height;

                halfWidth = c_width / 2;
                halfHeight = c_height / 2;

                scene = new THREE.Scene();
                camera = new THREE.PerspectiveCamera( 45, c_width/c_height, 1, 1000);

                renderer =  new THREE.WebGLRenderer( { canvas: canvas } );
                renderer.setSize(c_width, c_height);
            };

            window.load = function() {

                var headRadius = 5;
                var headGeometry = new THREE.SphereGeometry( headRadius, 32, 32 );
                var headMaterial = new THREE.MeshBasicMaterial( { color: 0xff0000 } );
                head = new THREE.Mesh( headGeometry, headMaterial );

                var bodyRadius = 10;
                var bodyHeight = 25;
                var bodyGeometry = new THREE.CylinderGeometry( bodyRadius, bodyRadius, bodyHeight );
                var bodyMaterial = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
                body = new THREE.Mesh( bodyGeometry, bodyMaterial );

                var legRadius = 3;
                var legHeight = 25;
                var legGeometry = new THREE.CylinderGeometry( legRadius, legRadius, legHeight );
                var legMaterial = new THREE.MeshBasicMaterial( { color: 0xffff00 } );
                leftLeg = new THREE.Mesh( legGeometry, legMaterial );

                rightLeg = new THREE.Mesh( legGeometry, legMaterial );

                var armRadius = 3;
                var armHeight = 30;
                var armGeometry = new THREE.CylinderGeometry( armRadius, armRadius, armHeight );
                var armMaterial = new THREE.MeshBasicMaterial( { color: 0x00ffff } );
                leftArm = new THREE.Mesh( armGeometry, armMaterial );

                rightArm = new THREE.Mesh( armGeometry, armMaterial );

                var translationMat = new THREE.Matrix4();

                translationMat.makeTranslation( 0, (bodyHeight / 2) + headRadius, 0 );
                head.applyMatrix( translationMat );

                translationMat.makeTranslation( -bodyRadius + legRadius, (-bodyHeight / 2) - (legHeight / 2), 0 );
                leftLeg.applyMatrix( translationMat );

                translationMat.makeTranslation( bodyRadius - legRadius, (-bodyHeight / 2) - (legHeight / 2), 0 );
                rightLeg.applyMatrix( translationMat );

                translationMat.makeTranslation( -bodyRadius - armRadius, 0, 0 );
                leftArm.applyMatrix( translationMat );

                translationMat.makeTranslation( bodyRadius + armRadius, 0, 0 );
                rightArm.applyMatrix( translationMat );

                body.add(head);
                body.add(leftLeg);
                body.add(rightLeg);
                body.add(leftArm);
                body.add(rightArm);

                scene.add(body);

                camera.position.setZ(120);
            };

            window.render = function() {
                Utils.requestAnimFrame(render);

                elapsedTime = ( (new Date).getTime() - initialTime );
                if (elapsedTime < animationRate) return;

                var steps = Math.floor( elapsedTime / animationRate );
                while(steps > 0) {
                    animate();
                    renderer.render(scene, camera);
                    steps -= 1;
                }

                initialTime = (new Date).getTime();
            };

            function animate() {

                sceneTime += 33/1000;
            }
            
        }());

    </script>
</head>
<body onload="runThreeJsApp()">
    <canvas id="canvas-id" width="400" height="400">
        Please use a browser supporting "canvas"
    </canvas>

    <script type="text/javascript">
        $("#canvas-id").mousemove( function(event) {
        } );
    </script>
</body>
</html>